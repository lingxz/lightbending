%!TEX root = ../thesis.tex
\chapter{Description of the Swiss-cheese model}
\label{chapter:swiss-cheese}

\section{Spacetime patches}

Swiss-cheese (SC) models were first introduced by \citet{einstein1945influence} to investigate the gravitational field of a mass well described by the Schwarzschild metric but embedded in a non-Minkowski background spacetime. Such a model is contructed by removing a comoving sphere from the homogeneous background and replacing it with an inhomogeneous mass distribution (see \autoref{fig:swiss-cheese}). In this case, we use a mass distribution that is vacuum everywhere except for a point mass at the centre. In principle, since the sphere is comoving, multiple spheres can be inserted in the cheese as long as they are initially non-overlapping. In our model, only one hole is needed to model the lens. This stitching of two metrics on the cheese-hole boundary is of course not arbitrary, and matching conditions will impose restriction on the parameters of the two metrics. This will be discussed in detail in the following sections. 

\begin{figure}
  \centering
  \includegraphics[height=0.3\linewidth]{images/swiss-cheese.pdf}
  \caption{Construction of a Swiss-cheese model}
  \label{fig:swiss-cheese}
\end{figure}

There are several reasons why this model was chosen. First, this is an exact solution of Einstein's equations which preserves the global dynamics, and hence it will allow us to properly investigate the higher order corrections that have been oft-debated in literature. Secondly, by putting observers in the homogeneously expanding "cheese", it accounts for observers moving with the Hubble flow, which is a common objection to Rindler and Ishak's use of a static metric \citep{park2008rigorous,khriplovich2008does,simpson2010lensing,butcher2016no}. Lastly, this model also takes the finite range of the mass into account by confining the influence of the central mass to the size of the hole. 

Light propagation in SC models has been extensively studied \citep{szybka2011light,vanderveld2008luminosity,fleury2014swiss}, but not particularly so in the subject of the $\Lambda$ dependence on gravitational lensing. Some of the areas that Swiss-cheese models have been commonly used include investigating the effect of local inhomogeneities on luminosity-redshift relations \citep{kantowski1969corrections,fleury2013interpretation} and studying fluctuations in redshift and distance of the cosmic microwave background \citep{bolejko2009szekeres,valkenburg2009swiss,bolejko2011effect}. 

A significant difference between the Swiss-cheese model and what is used in conventional gravitational lensing, as described in the previous section, is that in the Swiss-cheese, the bending happens only inside the hole, whereas in conventional lensing, the mass is superimposed on the FRW background and has infinite range. In the Swiss-cheese model, due to the boundary conditions, all bending is truncated once the light ray leaves the hole, and outside the hole the light ray travels as if the hole does not exist. Therefore even in the $\Lambda = 0$ case, we would expect a slightly smaller bending angle in the Swiss-cheese than predicted in conventional lensing, even though this difference is small. 

\citet{kantowski2010gravitational} did analytical calculations in estimating the bending angle in the Swiss-cheese model in flat space (see Eq. 32 of \citet{kantowski2010gravitational}). This prediction, together with the conventional lensing prediction (\autoref{eq:series-expansion-R}) and the Rindler and Ishak prediction (\autoref{eq:rindler-ishak-alpha}), are the theoretical models that we will be comparing our numerical results against. 

% In the Swiss-cheese model, in principle multiple holes can be inserted into the cheese. In this project, we use a single hole for the lens. 

\subsection{Friedmann-Robertson-Walker geometry}

Outside the hole, geometry is described by the Friedmann-Robertson-Walker (FRW) metric, the simplest homogeneous and isotropic model of the universe. Its line element, in spherical polar coordinates, is given by \citep{wald2010general}

\begin{equation}
  ds^2 = -dt^2 + a(t)^2 \left ( \frac{dr^2}{1-kr^2} + r^2 d \Omega^2 \right )
  \label{eq:frw-metric}
\end{equation}
where $d \Omega^2 = d\theta^2 + \sin^2\theta d\phi^2$ is the metric on a 2-sphere, $a(t)$ is the varying scale factor of the universe, and $k$ represents the curvature of space. This is the line element for a homogeneous and expanding universe with general spatial curvature. There are 3 possibilities for the value of $k$, each implying a different geometry of the universe:

\begin{itemize}
  \item $k = 0$: The universe is flat and Euclidean.
  \item $k > 0$: The universe has positive spatial curvature and is closed
  \item $k < 0$: The universe has negative spatial curvature and is open. 
\end{itemize}

The scale factor $a$ parametrises the relative expansion of the universe, such that the relationship between physical distance and comoving distance between two points at a certain cosmic time $t$ is given as

\begin{equation}
  d_{\text{physical}} = a(t) d_{\text{comoving}}.
  \label{eq:comoving-physical-distance}
\end{equation}

The scale factor also satisfies the Friedmann equation

\begin{equation}
  H^2 \equiv \left ( \frac{1}{a}\frac{da}{dt} \right )^2 = \frac{8\pi G \rho}{3} + \frac{\Lambda}{3} - \frac{k}{a^2}
  \label{eq:friedmann-equation}
\end{equation}
where $\rho$ is the energy density of a pressureless fluid and $H$ is the Hubble parameter. 

It is common to introduce the cosmological parameters, where a subscript 0 refers to quantities evaluated today: 

\begin{equation}
  \Omega_m = \frac{8\pi G \rho_0}{3H_0^2}, \,\, \Omega_{\Lambda} = \frac{\Lambda}{3H_0^2}, \,\, \Omega_k = - \frac{k}{a_0^2 H_0^2}
  \label{eq:cosmo-params}
\end{equation}
and rewrite the Friedmann equation as

\begin{equation}
  H^2 = H_0^2 \left [ \Omega_m \left ( \frac{a_0}{a}\right )^3 + \Omega_k \left ( \frac{a_0}{a}\right )^2 + \Omega_{\Lambda} \right ]
  \label{eq:friedmann-eqn-version2}
\end{equation}
where the $\Omega$ terms are commonly known as density parameters, evaluated at the present day. In the absence of radiation, they obey the relation

\begin{equation}
  \Omega_m + \Omega_{\Lambda} + \Omega_k = 1.
  \label{eq:density-parameters-1}   
\end{equation} 

In a flat universe, space is Euclidean and $\Omega_k = 0$. 

% Subsequently in this report instead of working directly with $\Lambda$ I will work with $\Omega_{\Lambda}$ instead. 

\subsection{Kottler geometry}

In this project we use a Kottler condensation in the Swiss-cheese for the central lensing mass. This is described by a Kottler metric \citep{kottler1918physikalischen}, which is the extension of the famous Schwarzschild metric to include a cosmological constant, given by

\begin{equation}
  ds^2 = -f(R)dT^2 + \frac{dR^2}{f(R)} + R^2 d \Omega^2
  \label{eq:kottler-metric}
\end{equation}
with
\begin{equation}
  f(R) = 1-\frac{2M}{R} - \frac{\Lambda R^2}{3},
  \label{eq:kottler-metric-f}
\end{equation}
where M is the mass of the central object. Unlike the FRW, this metric describes a static spacetime. 

\section{Matching conditions}

Two geometries can be matched across the boundary to form a well defined spacetime if and only if they satisfy the Darmois-Israel junction conditions \citep{darmois1927equations,israel1966singular}. These conditions dictate that the first and second fundamental forms of the two metrics must match on the matching hypersurface $\Sigma$, that is, both metrics must induce 
\begin{inparaenum}[(i)]
  \item the same metric, and 
  \item the same extrinsic curvature.
\end{inparaenum}

\subsection{Continuity of the induced metric}

We match the FRW and Kottler metrics on a surface of a comoving 2-sphere, $\Sigma$, which is defined by $r = r_h = \text{constant}$ in FRW coordinates and $R = R_h(T)$ in Kottler coordinates.

The induced metric is the quantity 

\begin{equation}
  h_{ab} = g_{\alpha \beta} j^{\alpha}_{a} j^{\beta}_{b}
  \label{eq:induced-metric-defn}
\end{equation}
where $j^{\alpha}_{a}$ is defined as

\begin{equation}
  j^{\alpha}_{a} = \frac{\partial \bar{X}^{\alpha}}{\partial \sigma^a}.
  \label{eq:j-defn}
\end{equation}
Here we have introduced $X^{\alpha}$ to represents coordinates of the original metric. We define $\sigma^a$ to be natural intrinsic coordinates for $\Sigma$, and $\bar{X}^{\alpha}(\sigma^a)$ is the parametric equation of the hypersurface. 

More concretely, using the coordinates defined previously in \autoref{eq:frw-metric}, these quantities are, for the FRW, 

\begin{subequations}
  \begin{align}
    X^{\alpha} &= \{ t, r, \theta, \phi \} \\
    \sigma^a &= \{ t, \theta, \phi \} \\
    \bar{X}^{\alpha}(\sigma^a) &= \{ t, r_h, \theta, \phi\}.
  \end{align}
\end{subequations}

Similarly, in the Kottler region, we have 

\begin{subequations}
  \begin{align}
    X^{\alpha} &= \{ T, R, \theta, \phi \} \\
    \sigma^a &= \{ T, \theta, \phi \} \\
    \bar{X}^{\alpha}(\sigma^a) &= \{ T, R_h(T), \theta, \phi\}.
  \end{align}
\end{subequations}

Using these definitions, the 3-metric induced by the FRW geometry on $\Sigma$ is

\begin{equation}
  ds^2_{\Sigma} = -dt^2 + a^2(t)r^2 d \Omega^2,
  \label{eq:frw-induced-metric}
\end{equation}
while the induced metric on the Kottler metric is
\begin{equation}
  ds_{\Sigma}^2 = -\kappa^2(T)dT^2 + R_h^2(T) d \Omega^2,
  \label{eq:kottler-induced-metric}
\end{equation}
where
\begin{equation}
  \kappa \equiv \sqrt{\frac{f^2[R_h(T)] - R_{h,T}^2(T)}{f[R_h(T)]}}.
  \label{eq:kottler-kappa}
\end{equation}

Equating the components of \autoref{eq:frw-induced-metric} and \autoref{eq:kottler-induced-metric}, we obtain the following:

\begin{equation}
  R_h(T) = a(t)r
  \label{eq:r-to-ar},
\end{equation}

\begin{equation}
  \frac{dt}{dT} = \kappa(T).
  \label{eq:dt-dT}
\end{equation}

% \begin{subequations}
%   \begin{align}
%     R_h(T) = a(t)r \\
%     \frac{dt}{dT} = \kappa(T).
%   \end{align}
% \end{subequations}

These two relationships relate the radial and time coordinates of the two metrics respectively. 

\subsection{Continuity of the extrinsic curvature}

The second condition equates extrinsic curvature of the two geometries. By definition, the extrinsic curvature $K_{ab}$ of a hypersurface is given by

\begin{equation}
  K_{ab} = n_{\alpha;\beta} j^{\alpha}_{a} j^{\beta}_{a}
  \label{eq:extrinsic-curvature-defn}
\end{equation}
where $n_{\mu}$ is the unit vector normal to $\Sigma$, $j$ is as defined previously in \autoref{eq:j-defn}, and the semicolon notation `;' denotes a covariant derivative, for example, $n_{\alpha;\beta} = \nabla_{\beta}\, n_{\alpha}$. For any vector $V^{\nu}$, the covariant derivative is defined as

\begin{equation}
  \nabla_{\mu}V^{\nu} = \partial_{\mu}V^{\nu} + \Gamma^{\nu}_{\mu \rho} V^{\rho}.
  \label{eq:covariant-derivative-defn}
\end{equation}

For a hypersurface defined by a function $q = 0$, the unit vector normal to it is

\begin{equation}
  n_{\mu} = \frac{q_{,\mu}}{\sqrt{g^{\alpha \beta} f_{,\alpha} f_{,\beta}}}.
  \label{eq:unit-normal-vector}
\end{equation}

In our case $q = r-r_h$ in FRW coordinates and $q = R - R_h(T)$ in Kottler coordinates. For example, the unit vector in the FRW region is trivial to calculate, and we get $n_{\mu}^{\text{(FRW)}} = \delta^r_{\mu}/a$. Applying this formula, the extrinsic curvature induced by the FRW geometry is

\begin{equation}
  K_{ab} dx^a dx^b = \frac{a(t)r}{\sqrt{1-kr^2}} d \Omega^2
  \label{eq:extrinsic-curvature-frw}
\end{equation}
while the extrinsic curvature induced by the Kottler geometry is
\begin{equation}
  K_{ab} dx^a dx^b = \frac{1}{\kappa} \left [ R_{h,tt} + \frac{f^{\prime}}{2f}(f^2 - 3R_{h,t}^2) \right ] dT^2 + \frac{R_h f}{\kappa} d \Omega^2
  \label{eq:extrinsic-curvature-kottler}
\end{equation}
where $f^{\prime} = \partial f / \partial R$, and all quantities are evaluated at $R = R_h(T)$.

Equating the components of \autoref{eq:extrinsic-curvature-frw} and \autoref{eq:extrinsic-curvature-kottler}, we obtain

\begin{equation}
  \frac{R_h f}{\kappa} = \frac{a(t)r}{\sqrt{1-kr^2}}
  \label{eq:kappa-to-fprime}
\end{equation}
and
\begin{equation}
  R_{h,tt} + \frac{f^{\prime}}{2f}(f^2 - 3R_{h,t}^2) = 0.
\end{equation}
The second equation is provided for completeness although it is not needed for subsequent derivations. 

\subsection{Consequences on properties of the hole}

Combining \autoref{eq:kappa-to-fprime} with \autoref{eq:kottler-kappa}, we can eliminate $\kappa$. We can also replace $R_{h,T}$ using the relation obtained in \autoref{eq:r-to-ar}, since

\begin{equation}
  \frac{dR_h}{dT} = \frac{d(ar)}{dT} = \frac{da}{dt}\frac{dt}{dT}r.
\end{equation}
where $da/dt$ is given by the Friedmann equation \ref{eq:friedmann-equation}. Following through with the algebra, we arrive at the somewhat intuitive result that both regions must have the same cosmological constant $\Lambda$ and that the Kottler hole has to be mass compensating, meaning the enclosed mass $M$ has to equal the mass excised from the FRW background:

\begin{equation}
  M = \frac{4\pi}{3} \rho a^3 r_h^3. 
  \label{eq:junction-conditions-mass-volume}
\end{equation}

From the junction conditions the rate of expansion of the hole in static coordinates can also be obtained. By combining \autoref{eq:kottler-kappa} and \autoref{eq:kappa-to-fprime}, we get an expression for $dR/dT$

\begin{equation}
  \frac{dR_h}{dT} = f(R_h) \sqrt{1- \frac{f(R_h)}{1-k r_h^2}}.
  \label{eq:hole-expansion-in-kottler-dR-dT}
\end{equation}

The last thing we need from the boundary conditions is to relate the tangent vectors between the two metrics. The continuity of the metric, imposed by the first junction condition, implies that the connection does not diverge across the boundary. Therefore, light is not deflected as it crosses the boundary and we just need to convert the components of the tangent vector between the two coordinate systems. To obtain $\dot{R}$ in terms of FRW tangent vectors $\dot{r}$ and $\dot{t}$, we differentiate \autoref{eq:r-to-ar} and substitute $da/dt$ with the Friedmann equation \autoref{eq:friedmann-equation}. Keeping in mind the boundary conditions, we get an expression for $\dot{R}$. The angular coordinates and angular tangent vectors are unchanged when moving from the Kottler to FRW coordinates, and vice versa. With $\dot{R}$ and $\dot{\phi}$, $\dot{T}$ then can be easily obtained from the null condition \autoref{eq:null-condition}. The result is

\begin{subequations}
  \begin{align}
    \dot{T} &= \frac{\dot{t}}{f}\sqrt{1-kr^2} + \frac{a\dot{r}}{f\sqrt{1-kr^2}} \sqrt{\frac{2M}{ar} - kr^2 + \frac{\Lambda}{3}a^2 r^2} \\
    \dot{R} &= \dot{t}\sqrt{\frac{2M}{ar} - kr^2 + \frac{\Lambda}{3}a^2 r^2} + a\dot{r}\\
    \dot{\phi} &= \dot{\phi}\\
    \dot{\theta} &= \dot{\theta}
  \end{align}
  \label{eq:kottler-to-frw-transform-jacobian}%
\end{subequations}
where for completeness I have also given the trivial relations between the angular tangent vectors. The quantities above are all evaluated at the boundary of the hole. This result is given for flat space in \citet{schucker2009strong} and \citet{fleury2013interpretation}, but here it has been extended to allow for arbitrary spatial curvature. The reverse transformation is easily obtained by inverting the Jacobian from above. 

In summary, given a FRW spacetime with pressureless matter and a cosmological constant $\Lambda$, a spherical hole, whose geometry is described by the Kottler metric, can be constructed which contains a constant mass $M = 4\pi \rho a^3 r_h^3/3$ at its centre. The geometry resulting from combining the two metrics at the boundary is an exact solution of the Einstein field equations. Applying the boundary conditions, we can obtain all the necessary transformations needed for continuation of light propagation at the boundary. 

\section{Light propagation}

We propagate a light ray backwards from observer to source by solving the geodesic equation (\autoref{eq:geodesic-eqn}). In reality, the light ray travels from source to observer, but our calculations proceed in the opposite direction since we want to take the current observer position and observation event as the initial condition. The observer is placed in the FRW region, where we start propagating the light ray. The mass of the lensing object is fixed and consequently so is the size of the hole. The light ray is started off with an Einstein angle $\theta_{E}$, travels through the FRW region, encounters the Kottler hole which deflects its trajectory, and returns to the FRW region again (see \autoref{fig:swiss-cheese-ray}. In the Swiss-cheese model, all the bending occurs only in the Kottler hole and is truncated once light leaves the hole. 

\begin{figure}
  \centering
  \includegraphics[height=0.4\linewidth]{images/swiss-cheese-ray2-cropped.pdf}
  \caption{A diagram of how a light ray propagates through the Swiss-cheese. Our calculations are done in the opposite direction of propagation. Due to the expansion of the universe, the physical size of the hole will be larger when the light exits the hole compared to when it entered.}
  \label{fig:swiss-cheese-ray}
\end{figure}

We begin by fixing the lens redshift, since it is the redshift that is directly observable and not the radial coordinate $r$. From the lens redshift, we can then calculate the radial coordinate and angular diameter distance to the lens. 

In the FRW, assuming $a_0 = 1$, we can calculate the angular diameter distance $D_L$ for a given lens redshift $z_L$ as \citep{hogg1999distance}

\begin{equation}
  D_L = D_A(z_L) = \frac{1}{1+z_L} S_k\left ( \frac{1}{H_0}\int_0^{z_L} \frac{dz}{\sqrt{\Omega_m(1+z)^3 + \Omega_k (1+z)^2 + \Omega_{\Lambda}}}  \right )
  \label{eq:angular-diameter-distance-redshit-z}
\end{equation}
where we define the function $S_k(x)$

\begin{equation}
  S_k(x) = 
  \begin{cases}
    \mathopen| k \mathclose|^{-1/2} \sin(\sqrt{\mathopen| k \mathclose|}x) & k > 0\\
    x & k = 0\\
    \mathopen| k \mathclose|^{-1/2} \sinh(\sqrt{\mathopen| k \mathclose|}x) & k < 0
  \end{cases}
  \label{eq:sk}
\end{equation}
and its inverse function

\begin{equation}
  S_k^{-1}(x) = 
  \begin{cases}
    \mathopen| k \mathclose|^{-1/2} \sin^{-1}(\sqrt{\mathopen| k \mathclose|}x) & k > 0\\
    x & k = 0 \\
    \mathopen| k \mathclose|^{-1/2} \sinh^{-1}(\sqrt{\mathopen| k \mathclose|}x) & k < 0
  \end{cases}
  \label{eq:sk-inverse}
\end{equation}

In terms of the angular diameter distance, the radial coordinate is given by 

\begin{equation}
  r_L = (1+z_L)D_L.
\end{equation}

Therefore, as we vary $\Lambda$, $r_L$ is expected to change since we fix $z_L$. We then place the lens at the origin and observer at a radial coordinate of $r = r_L$ and $\phi = \pi$. 

Numerical integration is done with the \texttt{scipy.integrate.solve\_ivp} function in Python \citep{jones2014scipy}, which uses an explict Runge-Kutte method of order $5$ \citep{dormand1980family}. The solver uses an adaptive step size, and the intersection between the light ray and the point of entry and exit of the hole are found with the classic Brent's method \citep{brent2013algorithms}, a root-finding algorithm. 

\subsection{FRW region}

The light ray begins from the observer in the FRW region. The starting tangent angle $\theta_E$ is fixed, and the initial tangent vectors are set such that $\theta_E = \tan^{-1}(\sqrt{1-kr^2}r\dot{\phi}/\dot{r})$. We place the lens at the origin and take the observer to be at an azimuthal angle of $\phi = \pi$. 

Null geodesics govern the trajectory of the light ray. Without loss of generality, we can take $\theta = \pi/2$ to simplify the geodesic equations. Due to spherical symmetry, the FRW has a conserved quantity $L = a^2 r^2 \dot{\phi}$ that corresponds to the angular momentum of the photon. In terms of the conserved quantity, the null geodesic equations are

\begin{subequations}
  \begin{align}
    \dot{t} &= -\sqrt{\frac{a^2\dot{r}^2}{1-kr^2} + a^2r^2 \dot{\phi}}\\
    \ddot{r}  &= (1-kr^2)r\dot{\phi}^2 - \frac{k\dot{r}^2}{1-kr^2} - \frac{2a_{,t}}{a}\dot{r}\dot{t}\\
    \dot{\phi} &= \frac{L}{a^2 r^2}
  \end{align}
  \label{eq:frw-null-geodesics}%
\end{subequations}
which, when combined with the Friedmann equation (\autoref{eq:friedmann-eqn-version2}), fully determine the light's path. The negative sign on $\dot{t}$ is due to the fact that we are propagating the light backwards in time. We can then solve these differential equations numerically and stop the integration once the light ray reaches the boundary of the hole, which is defined by $r_h = \text{constant}$. We call this intersection event $\mathcal{E}_{\text{out}}$, since this is where the light, traveling from the source to observer in the opposite direction of our numerical calculations, \emph{leaves} the hole. 

In the particular case of Euclidean geometry ($k = 0$), the coordinates of the event $\mathcal{E}_{\text{out}}$ can be calculated analytically. To do this, we first rewrite the flat metric in terms of the conformal time $\eta$, defined by $d\eta = dt/a(t)$, as

\begin{equation}
  ds^2 = a^2(\eta) \left ( -d \eta^2 + dr^2 + r^2 d \Omega^2 \right ).
  \label{eq:frw-metric-conformal-time}
\end{equation}

We can then write down the following system of equations in Cartesian coordinates $x^i_{\text{out}}$, in terms of the hole radius $r_h$ and Cartesian position of the observer $x^i_0$:

\begin{subequations}
  \begin{align}
  \delta_{ij} (x^i_{\text{out}} - x^i_h)(x^j_{\text{out}} - x^j_h) = r_h^2\\
  x^i_{\text{out}} = x^i_0 + (\eta_0 - \eta_{\text{out}})d^i    
  \end{align}
  \label{eq:flat-cartesian-frw}%
\end{subequations}
where $d^i$ is the unit vector representing direction of travel. For a given Einstein angle $\theta_E$, in Cartesian coordinates we have 

\begin{align}
    d &= \frac{1}{\sqrt{(\dot{r}\cos\phi - r\sin\phi\dot{\phi})^2 + (\dot{r}\sin\phi + r\cos\phi\dot{\phi})^2}}
          \begin{pmatrix}
           \dot{r}\cos\phi - r\sin\phi\dot{\phi} \\
           \dot{r}\sin\phi + r\cos\phi\dot{\phi} \\
         \end{pmatrix}
\end{align}

The final thing we need is to recover the scale factor from the conformal time. From \autoref{eq:flat-cartesian-frw}, we can obtain the value of $\eta_{\text{out}}$, since we can arbitrarily set $\eta_0 = 0$. We take $a_0 = 1$ at the observer, so the conformal time $\eta$ is related to $a$ by

\begin{equation}
  \eta_{\text{out}} = \frac{1}{H_0} \int_1^{a_{\text{out}}} \frac{1}{a^2 \sqrt{\Omega_m/a^3 + \Omega_{\Lambda}}}.
  \label{eq:conformal-time-eta-to-a-integral}
\end{equation}
where $H_0$ is the current value of the Hubble parmeter. Since $\eta$ increases monotonically with $a$, we did a simple binary search to find the value of $a_{\text{out}}$ that produced $\eta_{\text{out}}$ to the required level of accuracy. 

The above calculation only applies for flat space, and in arbitrarily curved space, we do the full numerical integration to obtain the conditions at $\mathcal{E}_{\text{out}}$.

\subsection{Conversion from FRW region to Kottler region at $\mathcal{E}_{\text{out}}$}
\label{subsec:frw-to-kottler}

From the FRW coordinates and tangent vectors, we can first obtain the starting coordinate $R_{\text{out}}$ from \autoref{eq:r-to-ar}. The angular coordinates remain the same in both coordinate systems. We are free to set $T_{\text{out}} = 0$ since we are not concerned with the amount of time taken by the light, only the trajectory. 

The initial tangent vectors to start off the Kottler integration can be obtained from the Jacobian derived in the previous section (\autoref{eq:kottler-to-frw-transform-jacobian}).

\subsection{Kottler region}

Inside the hole, the staticity and spherical symmetry of the Kottler metric imply the existence of two conserved quantities, $E = f(R) \dot{t}$ and $L = R^2 \dot{\phi}$, which correspond to the energy and angular momentum of the photon respectively. The null condition, after rearranging to make $\dot{R}$ the subject, reads

\begin{equation}
  \dot{R} = \pm \sqrt{E^2 - \frac{L^2}{R^2} \left ( 1 - \frac{2M}{R} - \frac{\Lambda R^2}{3}\right )}.
  \label{eq:kottler-null-condition}
\end{equation}
The $\pm$ before square root on the right hand side is troublesome for numerical computations because it would become necessary to determine a point to switch signs for $\dot{R}$. To circumvent that, we can differentiate the equation obtained from the null condition to get a second order differential equation in $R$. Combining that with the conserved quantities, we have the following equations which fully determine the light trajectory in Kottler space:

\begin{subequations}
  \begin{align}
    \dot{T} &= \frac{E}{f(R)}\\
    \ddot{R}  &= \frac{L^2 (R-3M)}{R^4}\\
    \dot{\phi} &= \frac{L}{R^2}.
  \end{align}
  \label{eq:kottler-null-geodesics}%
\end{subequations}
Note that the second order differential equation in $R$ now has no dependence on $\Lambda$, which is the aforementioned conventional argument pioneered by \citet{islam1983cosmological} for why $\Lambda$ does not directly contribute to lensing. 

At the same time that the light ray is moving through the Kottler hole, the hole boundary is also changing in the static coordinates, with an expansion rate governed by \autoref{eq:hole-expansion-in-kottler-dR-dT}. This equation needs to be integrated simulataneously with the null geodesic equations in order to find the point that the light ray intersects with the hole again. We call this event $\mathcal{E}_{\text{in}}$, again to emphasize the fact that this is where light enters the hole, although the propagation is done in the opposite direction. 

\subsection{Conversion from Kottler region to FRW region at $\mathcal{E}_{\text{in}}$}

Conversion from the Kottler to FRW region is simply the reverse of the transformations stated in \autoref{subsec:frw-to-kottler}. We set $t_{\text{in}} = 0$ since we are not concerned with the path time. 

\subsection{Back in the FRW region}

Once we get back to the FRW region, we continue using FRW null geodesics (\autoref{eq:frw-null-geodesics}) to propagate the light and stop once we reach the axis. The coordinate at which it crosses the axis is then recorded. 

In flat space, numerical integration here is no longer necessary, since there will be no more bending in this region. Thus the intersection of the light path with the axis can be calculated from the tangent vector directly once light exits the Kottler hole. 

\subsection{Converting raw radial coordinates to angular diameter distances}

Our aim is to compare our results against the cosmological lens equation (\autoref{eq:lens-eqn}), using strictly observable quantities. Gravitational lensing analysis is usually done with us (the observer) at the origin, but in our model we have placed the lens at the origin instead out of convenience. Therefore we take extra care when converting from raw radial coordinates back into observable angular distances. By an extension of the redshift formula (\autoref{eq:angular-diameter-distance-redshit-z}), we can get the angular diameter distance between two arbitrary points given their respective radial coordinates \citep{peacock1999cosmological}

\begin{equation}
  D_{AB} = \frac{a_0  S_k(S_k^{-1}(r_B) - S_k^{-1}(r_A))}{1+z_B}
\end{equation}

Applying this formula and remembering that we place the observer at $(r, \phi) = (r_L, \pi)$, we can use our final numerical coordinate at $(r, \phi) = (r_{LS}, 0)$ to get $D_S$ and $D_{LS}$:

\begin{subequations}
  \begin{gather}
    D_{S} = \frac{S_k(S_k^{-1}(r_{LS}) + S_k^{-1}(r_L))}{1+z_S}\\
    D_{LS} = \frac{r_{LS}}{1+z_S}
  \end{gather}
\end{subequations}

With this, we now have all the formulation needed to carry out the numerical integration and also to translate the numerical results into observable quantities. 

We also extend this model beyond a Kottler hole to a general static mass distribution, by replacing the Kottler metric by a LTB metric with pressure and deriving the null geodesics again in this spacetime. The quantities and results for the LTB metric are presented in \autoref{appendix:ltb}.